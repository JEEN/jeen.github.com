
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Jeen - Yet anothere techlog</title>
    <meta name="author" content="Jeen Lee">
    
	<meta name="description" content="Published on: Jul 26th, 2012 Tags: Facebook, perl 지난번 1회 티타임때의 문제가 제대로 참가비 징수를 못해서 비용정산에 어려움이 있었는데,
이 문제를 해결하기 위해서 간단하게 참가자 리스트를 A4 용지로 뽑아내서 체크하도록 &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="Jeen - Yet anothere techlog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='http://fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='http://fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>

    <!-- remove or comment it to disable ajaxification -->   
    <script src="/javascripts/ajaxify.js"></script>
   
    
    
	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-27958809-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


</head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        Jeen Lee
    </div>
</h1>
<br>

<ul id="social-links" style="text-align:center">
  
  <!-- GitHub -->
  <li>
  <a href="https://github.com/jeen" class="github" title="Github"></a>
  </li>
  
  
  
  
  <!-- Twitter -->
  <li>
  <a href="http://www.twitter.com/JEEN_LEE" class="twitter" title="Twitter"></a>
  </li>
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/blog/archives/index.html">Archives</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form method="get" action="/search.html" id="search">
            <input name="query" type="text" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload --> 
    <div id="content" class="inner">
        


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/07/26/export-facebook-event-attending-list-perl-kr-teatime/">
		
			Export Facebook Event Attending List - Perl-kr TeaTime</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-07-26T14:22:00+09:00" pubdate data-updated="true">Jul 26<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/facebook/'>Facebook</a>, <a class='category' href='/blog/categories/perl/'>perl</a>


</div>
    </div>
		<p> 지난번 1회 티타임때의 문제가 제대로 참가비 징수를 못해서 비용정산에 어려움이 있었는데,
이 문제를 해결하기 위해서 간단하게 참가자 리스트를 A4 용지로 뽑아내서 체크하도록 하는 건 어떨까 하는 생각이 있었습니다.</p>

<ul>
<li><a href="http://jeen.tistory.com/entry/perlkr-%ED%8B%B0%ED%83%80%EC%9E%84-2-%EC%84%B1%ED%99%A9%EB%A6%AC%EC%97%90-%EB%81%9D%EB%82%AC%EC%8A%B5%EB%8B%88%EB%8B%A4">#perl-kr 티타임 Vol.2</a></li>
</ul>


<p>아무튼 그런 생각을 잠깐 했다가 해볼까 해서 아래처럼 코드를 써넣었습니다.</p>

<p>~~~
use strict;
use warnings;
use Text::Xslate;
use Data::Section::Simple;
use Facebook::Graph;</p>

<p>my $fb = Facebook::Graph->new;
$fb->access_token(&ldquo;YOUR ACCESS TOKEN&rdquo;);
my $r = $fb->fetch(&lsquo;466164950078338/attending&rsquo;);
my @attendees;
for my $person (@{ $r->{data} }) {</p>

<pre><code>my $f = $fb-&gt;fetch($person-&gt;{id});
$f-&gt;{profile_image} = $fb-&gt;picture($person-&gt;{id})-&gt;get_large-&gt;uri_as_string;  
push @attendees, $f;
</code></pre>

<p>}
push @attendees, {} for (1..3);</p>

<p>my $tx  = Text::Xslate->new(</p>

<pre><code>syntax =&gt; 'TTerse',
module =&gt; \[ 'Text::Xslate::Bridge::TT2Like' \],
path =&gt; \[
    Data::Section::Simple-&gt;new()-&gt;get_data_section()
\],
</code></pre>

<p>);</p>

<p>print $tx->render(&lsquo;template.tx&rsquo;, { attendees => \@attendees });</p>

<p><strong>DATA</strong></p>

<p>@@ template.tx
<html>
 <head>
   <title>#perl-kr 티타임 #2</title>
   <style></p>

<pre><code> \[% INCLUDE "css.tx" %\]
</code></pre>

<p>   </style>
 </head>
 <body>
   <h1>※ #perl-kr 티타임 #2</h1>
   <table class="table table-striped table-bordered" style="width:50%"></p>

<pre><code> &lt;thead&gt;
   &lt;tr&gt;
     &lt;th class="span1"&gt;&amp;nbsp;&lt;/th&gt;
     &lt;th class="span1"&gt;&amp;nbsp;&lt;/th&gt;
     &lt;th class="span2"&gt;Name&lt;/th&gt; 
     &lt;th class="span1"&gt;Attend?&lt;/th&gt;
   &lt;/tr&gt;
 &lt;/thead&gt;
 &lt;tbody&gt;
   \[% FOREACH p IN attendees %\]
   &lt;tr&gt;
     &lt;td&gt;\[% loop.count %\]&lt;/td&gt;
     &lt;td&gt;&lt;img src="\[% p.profile_image %\]" width="30" height="30" /&gt;&lt;/td&gt;
     &lt;td&gt;\[% p.name %\]\[% IF p.username %\](\[% p.username %\])\[% END %\]&lt;/td&gt; 
     &lt;td&gt;&lt;/td&gt;
   &lt;/tr&gt;
   \[% END %\] 
 &lt;/tbody&gt;
</code></pre>

<p>   </table>
 </body>
</html></p>

<p>@@ css.tx
table {
  max-width: 100%;
  border-collapse: collapse;
  border-spacing: 0;
}</p>

<p>.table {
  width: 100%;
  margin-bottom: 18px;
}
.table th, .table td {
  padding: 8px;
  line-height: 18px;
  text-align: left;
  vertical-align: top;
  border-top: 1px solid #ddd;
}
.table th {
  font-weight: bold;
}
.table thead th {
  vertical-align: bottom;
}
.table thead:first-child tr th, .table thead:first-child tr td {
  border-top: 0;
}
.table tbody + tbody {
  border-top: 2px solid #ddd;
}
.table-condensed th, .table-condensed td {
  padding: 4px 5px;
}</p>

<p>.table-bordered {
  border: 1px solid #ddd;
  border-collapse: separate;
  *border-collapse: collapsed;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
  border-radius: 4px;
}
.table-bordered th + th, .table-bordered td + td, .table-bordered th + td, .table-bordered td + th {
  border-left: 1px solid #ddd;
}
.table-bordered thead:first-child tr:first-child th, .table-bordered tbody:first-child tr:first-child th, .table-bordered tbody:first-child tr:first-child td {
  border-top: 0;
}
.table-bordered thead:first-child tr:first-child th:first-child, .table-bordered tbody:first-child tr:first-child td:first-child {
  -webkit-border-radius: 4px 0 0 0;
  -moz-border-radius: 4px 0 0 0;
  border-radius: 4px 0 0 0;
}
.table-bordered thead:first-child tr:first-child th:last-child, .table-bordered tbody:first-child tr:first-child td:last-child {
  -webkit-border-radius: 0 4px 0 0;
  -moz-border-radius: 0 4px 0 0;
  border-radius: 0 4px 0 0;
}
.table-bordered thead:last-child tr:last-child th:first-child, .table-bordered tbody:last-child tr:last-child td:first-child {
  -webkit-border-radius: 0 0 0 4px;
  -moz-border-radius: 0 0 0 4px;
  border-radius: 0 0 0 4px;
}
.table-bordered thead:last-child tr:last-child th:last-child, .table-bordered tbody:last-child tr:last-child td:last-child {
  -webkit-border-radius: 0 0 4px 0;
  -moz-border-radius: 0 0 4px 0;
  border-radius: 0 0 4px 0;
}
.table-striped tbody tr:nth-child(odd) td, .table-striped tbody tr:nth-child(odd) th {
  background-color: #f9f9f9;
}</p>

<p>.table tbody tr:hover td, .table tbody tr:hover th {
  background-color: #f5f5f5;
}</p>

<p>table .span1 {
  float: none;
  width: 44px;
  margin-left: 0;
}
table .span2 {
  float: none;
  width: 124px;
  margin-left: 0;
}
table .span3 {
  float: none;
  width: 204px;
  margin-left: 0;
}
table .span4 {
  float: none;
  width: 284px;
  margin-left: 0;
}
table .span5 {
  float: none;
  width: 364px;
  margin-left: 0;
}
table .span6 {
  float: none;
  width: 444px;
  margin-left: 0;
}
table .span7 {
  float: none;
  width: 524px;
  margin-left: 0;
}
table .span8 {
  float: none;
  width: 604px;
  margin-left: 0;
}
table .span9 {
  float: none;
  width: 684px;
  margin-left: 0;
}
table .span10 {
  float: none;
  width: 764px;
  margin-left: 0;
}
table .span11 {
  float: none;
  width: 844px;
  margin-left: 0;
}</p>

<p>table .span12 {
  float: none;
  width: 924px;
  margin-left: 0;
}
~~~</p>

<p>급작스레 한 작업이라 그냥 간단히 HTML 로 뽑아버렸지만&hellip; 사실 꿈은 좀 더 아름다운 레이아웃으로 뙇하고 나와줬으면 했었지요.</p>

<p>일단 예정 참가자 이외에 예상치못한 참가자가 있을 것을 염두해서 3개정도의 행을 더 추가해주었구요;;</p>

<p><code>Text::Xslate</code> + <code>Data::Section::Simple</code> 의 조합은 파일하나에 우걱우걱 템플릿까지 끼워넣고 이럴 경우에는 아주 좋았습니다.</p>

<p>CSS 도 그냥 별도의 섹션으로 나눠서 <code>INCLUDE</code> 해버릴 수도 있으니 :&ndash;)</p>

<p><code>Facebook::Graph</code> 모듈은 생각보다 좀 변태같습니다. 그 이유는 Facebook Graph API 도 변태같다는 근본적인 &hellip;. 그리고 Access Token 은 뭐 적당하게 Developer 페이지 가서 줏어서 넣었습니다. :&ndash;)</p>

<p><img src="https://lh6.googleusercontent.com/-GrgEvhNP0d0/UBDW9W-YzLI/AAAAAAAACAQ/5G48cMzvryY/w389-h521-k/list.jpg" alt="" /></p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/07/18/mysql-diff-a-vs-b/">
		
			MySQL::Diff - a vs B</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-07-18T18:30:00+09:00" pubdate data-updated="true">Jul 18<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/mysql/'>mysql</a>, <a class='category' href='/blog/categories/perl/'>perl</a>


</div>
    </div>
		<p> 최근에 유지보수 관련 일로 골머리를 싸고 있다가 겨우겨우 마무리하고 있는 일이 하나 있었습니다.</p>

<p> PHP 프로젝트였는데, 유지보수 관련해서 여러가지 이슈들이 나오기 마련이고, 그 때문에 잘 움직이던 기존의 DB구조를 변경해줄 필요가 있었습니다.</p>

<p> 뭐 테이블을 추가하거나, 어떤 컬럼의 형식을 변경하거나, 혹은 인덱스를 추가하거나 하는 뭐 이런 경우 말이죠.</p>

<p> 처음에는 개발환경아래에서 기존의 product 환경에서 운용중인 DB를 dump 떠와서 진행하고, 프로젝트를 진행하면서 변경되는 SQL 내용들을 일일이 적어주었습니다. 그러다가 뭐 이사람 저사람 손을 옮겨타다가 결국 최종 마무리단계에서 어떤 컬럼이 변경되었는지, 어떤 테이블이 추가되었는지에 대한 확신을 할 수 없었습니다.</p>

<p> 그래서 기록된 SQL 을 기반으로 눈과 손으로 검수를 해야하는 지경에서 결국 실수가 생기기 마련이죠. 그리고 클레임이 발생했습니다.</p>

<p> 자, 그럼 어떻게 하면 이런 상황에서 사태를 수습하느냐&hellip; 고심했습니다.</p>

<p> 그 결과 혹시 이거라면 해서 찔러본 것이 빙고 였던 것이 <a href="http://metacpan.org/module/MySQL::Diff">MySQL::Diff</a> 였습니다.</p>

<p> 맨처음 덤프떠온 DB 를 <code>DB_A</code> 로 지정하고, 최종적으로 개발이 종료된 DB 를 <code>DB_B</code> 라고 놓습니다.</p>

<p> 이 <code>DB_A</code> 와 <code>DB_B</code> 를 서로 비교하는 것이죠. 그걸을 위해서 <code>MySQL::Diff</code> 모듈이 사용됩니다.</p>

<p>~~~ bash
$ mysqldiff &mdash;host1 localhost &mdash;user1 root &mdash;password1 whatthehell &mdash;host2 localhost &mdash;user2 root &mdash;password2 whatthehell bto bto_test</p>

<h2>mysqldiff 0.43</h2>

<h2></h2>

<h2>Run on Wed Jul 18 18:26:39 2012</h2>

<h2>Options: password2=whatthehell, password1=whatthehell, user1=root, host2=localhost, debug=0, host1=localhost, user2=root</h2>

<h1>#</h1>

<h2>&mdash;&ndash;   db: bto (host=localhost user=root)</h2>

<h2>+++   db: bto_test (host=localhost user=root)</h2>

<p>ALTER TABLE auth DROP COLUMN updated_on; # was datetime NOT NULL DEFAULT &lsquo;0000-00-00 00:00:00&rsquo;
ALTER TABLE auth DROP COLUMN created_on; # was datetime NOT NULL DEFAULT &lsquo;0000-00-00 00:00:00&rsquo;
ALTER TABLE auth ADD UNIQUE passwd (passwd);
CREATE TABLE test1 (
  test1 int(11) NOT NULL
) ENGINE=MyISAM DEFAULT CHARSET=utf8;
~~~</p>

<p>위처럼 컬럼의 삭제, 인덱스의 추가, 테이블의 추가 등 모든 변경 내역들이 나오게 됩니다.</p>

<p>다음부터는 이처럼 좀 더 간단하고 확실하게 할 수 있는 방법을 취해야 되겠습니다.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2012/07/18/export-github-issues/">
		
			Export Github Issues</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: 








  


<time datetime="2012-07-18T15:44:00+09:00" pubdate data-updated="true">Jul 18<span>th</span>, 2012</time></div>
      <div class="tags">Tags: 


	<a class='category' href='/blog/categories/github/'>github</a>, <a class='category' href='/blog/categories/perl/'>perl</a>


</div>
    </div>
		<p>회사에서는 한달에 $20 인가 지불하면서 Github 을 쓰고 있습니다.</p>

<p>$20 플랜에서는 한정적인 Private Repo 밖에 만들지 못합니다. 그래서 완료가 된 프로젝트에 대해서는
Github Repo 를 닫고 사내 Git Repo 로 옮기는 방식으로 사용하고 있습니다.</p>

<p>그럴거면 그냥 사내 Git Repo 를 사용할 것이지 왜 돈내가면서 Github 를 쓰느냐고 물으신다면,
Github 에서 제공해주는 Issue 관리라든가, Wiki 라든가 여러모로 통합이 잘되어 있고 깔끔해서
사용하기 편하다고 그냥 그렇게 말하렵니다.</p>

<p>아무튼 그러면서, 프로젝트 뿐 아니라 회사내에 발생하는 다양한 이슈들은 Bugzilla 에 기록해놓습니다.</p>

<p>다 끝나서 닫아야할 프로젝트들을 사내 Repo 로 옮기는 것은 좋지만, Issues 안에 적어둔 깨알같은 내용들과 코멘트들 등등을 고스란히 다 허공으로 날려버려야 된다는 것은 뼈아픈 일입니다.</p>

<p>그래서 잠깐 시간을 내서 Issues 에 있는 내용(이슈타이틀,내용,코멘트, Git commit, 이슈 참조 등등)을 뽑아서 Bugzilla 에 담아놓기 좋게 코드를 써봤습니다.</p>

<p>~~~ perl export-github-issues.pl
use strict;
use warnings;
use Text::Xslate;
use Data::Section::Simple;
use Net::GitHub::V3;
use Config::Pit;</p>

<p>my $pit = pit_get(&lsquo;github.com&rsquo;, require => {</p>

<pre><code>login =&gt; "Your login",
pass  =&gt; "Your pass",
</code></pre>

<p>});</p>

<p>my $github = Net::GitHub::V3->new(</p>

<pre><code>login =&gt; $pit-&gt;{login},
pass  =&gt; $pit-&gt;{pass},
</code></pre>

<p>);</p>

<p>my ($user, $repo) = @ARGV;
unless ($user &amp;&amp; $repo) {</p>

<pre><code>print "Usage: perl p.pl silexkr Donnenwa\n";
exit;
</code></pre>

<p>}</p>

<p>my $tx  = Text::Xslate->new(</p>

<pre><code>syntax =&gt; 'TTerse',
module =&gt; \[ 'Text::Xslate::Bridge::TT2Like' \],
path =&gt; \[
    Data::Section::Simple-&gt;new()-&gt;get_data_section()
\],
</code></pre>

<p>);</p>

<p>my $issue = $github->issue;
my @issues = $issue->repos_issues($user, $repo, { state => &lsquo;closed&rsquo; });
while($issue->has_next_page) {</p>

<pre><code>push @issues, $issue-&gt;next_page;
</code></pre>

<p>}</p>

<p>for my $iss (@issues) {</p>

<pre><code>my @comments = ();
my @events   = ();
eval { @comments = $issue-&gt;comments('silexkr', $repo, $iss-&gt;{number}) };
eval { @events   = $issue-&gt;events('silexkr', $repo, $iss-&gt;{number}) };
print $tx-&gt;render('text.tx', { %{ $iss }, comments =&gt; \@comments, events =&gt; \@events });
</code></pre>

<p>}</p>

<p><strong>DATA</strong></p>

<p>@@ text.tx</p>

<p>[% number %].[% title %] [% FOREACH label IN labels %][% label.name %] [% END %]
  &ndash; [% user.login %]
  &ndash; [% created_at %] ~ [% closed_at %]
[% IF body %]
 // [% body %]
[% END %]
[% FOREACH comment IN comments %]
\= [% comment.user.login %] @ [% comment.updated_at %]
&mdash; [% comment.body %]
[% END %]
[% FOREACH event IN events %][% NEXT UNLESS event.commit_id %]
\= [% event.commit_id %][% END %]
~~~</p>

<p><a href="http://metacpan.org/module/Net::GitHub">Net::GitHub</a> 모듈에서 뭔가 코멘트를 뽑아내려는 데 없으면 계속 죽어버리는 문제 등등이 있어서 뭐 그냥 <code>eval {}</code> 로 묶어버렸구요.</p>

<p><a href="http://metacpan.org/module/Text::Xslate">Text::Xslate</a> 에서 <code>path</code> 를</p>

<p><del> perl
Data::Section::Simple->new()&ndash;>get_data_section();
</del></p>

<p>으로 해서 쉽게 <code>-&gt;render()</code> 의 첫번째 인수를 템플릿이름으로 지정할 수 있더군요.</p>

<p><code>Net::GitHub</code> 의 <code>-&gt;next_page</code> 가 최근 최근에 사용된 API 기준으로 동작을 하다보니, <code>while()</code> 안에서 <code>events</code>, <code>comments</code> 를 혼용해서 사용해버리면 의도한 대로 동작을 하지 않아서, <code>@issues</code> 안에 일단 전체 이슈를 뽑고서 시작을 했습니다.</p>

<p>아무튼 뭐 얼기설기 그냥 놔두기도 그렇고 혹여나 해서 일단 올려봅니다.</p>

		
		
	</div>

<div class="meta">
	
</div>
</article>

<nav id="pagenavi">
    
        <a href="/blog/page/9/" class="prev">Prev</a>
    
    
        <a href="/blog/page/11/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav>

    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2013

    Jeen Lee
. Powered by <a href="http://octopress.org">Octopress</a> | 
    Theme <a href="http://github.com/panks/fabric">fabric</a> by <a href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'jeen';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>





<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
